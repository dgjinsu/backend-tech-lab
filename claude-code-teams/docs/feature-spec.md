# 가계부 기능 설계서

## 서비스 한줄 요약

> 월급을 입력하고, 지출을 카테고리별로 기록하며, 내 용돈이 어디에 쓰이는지 한눈에 파악하는 개인 가계부

---

## 기능 전체 목록

### 1. 사용자 인증

| # | 기능 | 설명 | 우선순위 |
|---|------|------|----------|
| 1-1 | 회원가입 | 이메일, 비밀번호, 닉네임으로 가입 | P0 |
| 1-2 | 로그인 | 이메일/비밀번호 → JWT 토큰 발급 | P0 |
| 1-3 | 토큰 갱신 | Refresh Token으로 Access Token 재발급 | P0 |
| 1-4 | 로그아웃 | 클라이언트 토큰 삭제 + Redis 블랙리스트 | P1 |
| 1-5 | 비밀번호 유효성 | 8자 이상, 영문+숫자+특수문자 | P0 |

**화면**: 로그인 페이지, 회원가입 페이지

---

### 2. 급여 관리

| # | 기능 | 설명 | 우선순위 |
|---|------|------|----------|
| 2-1 | 급여 등록 | 월별 총 급여액 입력 | P0 |
| 2-2 | 고정 지출 등록 | 급여에 포함된 고정 지출 항목별 등록 (월세, 보험, 연금 등) | P0 |
| 2-3 | 가용 용돈 자동 계산 | 총 급여 - 고정 지출 합계 = 가용 용돈 | P0 |
| 2-4 | 급여 목록 조회 | 연도별 월급 내역 리스트 | P0 |
| 2-5 | 급여 상세 조회 | 고정 지출 포함 상세 정보 | P1 |
| 2-6 | 급여 수정 | 급여액, 고정 지출 항목 수정 | P1 |
| 2-7 | 급여 삭제 | 급여 삭제 시 고정 지출도 함께 삭제 | P2 |

**화면**: 급여 관리 페이지
- 월별 급여 카드 리스트
- 급여 등록/수정 모달 (고정 지출 항목 동적 추가/삭제)
- 가용 용돈 하이라이트 표시

**핵심 로직**:
```
가용 용돈 = 총 급여 - Σ(고정 지출 금액)
```

---

### 3. 지출 기록

| # | 기능 | 설명 | 우선순위 |
|---|------|------|----------|
| 3-1 | 지출 등록 | 금액, 카테고리, 날짜, 설명, 메모 입력 | P0 |
| 3-2 | 지출 목록 조회 | 월별 지출 리스트 (페이징) | P0 |
| 3-3 | 지출 필터링 | 카테고리별, 날짜 범위별 필터 | P1 |
| 3-4 | 지출 정렬 | 날짜순, 금액순 정렬 | P1 |
| 3-5 | 지출 수정 | 금액, 카테고리, 날짜, 설명 수정 | P1 |
| 3-6 | 지출 삭제 | 단건 삭제 | P1 |
| 3-7 | 지출 상세 조회 | 개별 지출 상세 정보 | P2 |

**화면**: 지출 관리 페이지
- 상단: 이번 달 총 지출 요약
- 필터바: 월 선택, 카테고리 필터, 정렬 옵션
- 지출 리스트: 날짜별 그룹핑, 카테고리 컬러 태그
- 지출 등록 모달: 금액 입력, 카테고리 선택, 날짜 피커, 설명/메모

---

### 4. 카테고리 관리

| # | 기능 | 설명 | 우선순위 |
|---|------|------|----------|
| 4-1 | 기본 카테고리 제공 | 식비, 카페/음료, 교통, 쇼핑, 문화/여가, 구독, 기타 | P0 |
| 4-2 | 카테고리 목록 조회 | 기본 + 사용자 정의 카테고리 통합 조회 | P0 |
| 4-3 | 사용자 정의 카테고리 추가 | 이름, 색상, 아이콘 지정 | P1 |
| 4-4 | 카테고리 수정 | 색상/아이콘 변경 (기본 카테고리는 이름 변경 불가) | P2 |
| 4-5 | 카테고리 삭제 | 사용자 정의만 삭제 가능, 연결 지출은 "기타"로 이관 | P2 |

**기본 카테고리**:

| 이름 | 색상 | 아이콘 |
|------|------|--------|
| 식비 | #FF6384 | utensils |
| 카페/음료 | #FFCE56 | coffee |
| 교통 | #36A2EB | bus |
| 쇼핑 | #4BC0C0 | shopping-bag |
| 문화/여가 | #9966FF | film |
| 구독 | #FF9F40 | repeat |
| 기타 | #C9CBCF | more-horizontal |

---

### 5. 예산 관리

| # | 기능 | 설명 | 우선순위 |
|---|------|------|----------|
| 5-1 | 카테고리별 월 예산 설정 | 카테고리마다 월 예산 금액 지정 (Upsert) | P1 |
| 5-2 | 예산 현황 조회 | 예산 대비 실제 지출, 잔여 금액, 소진율 표시 | P1 |
| 5-3 | 예산 초과 표시 | 소진율 100% 초과 시 빨간색 경고 | P1 |
| 5-4 | 예산 수정 | 금액 변경 | P2 |
| 5-5 | 예산 삭제 | 카테고리별 예산 삭제 | P2 |

**화면**: 예산 관리 페이지
- 카테고리별 예산 설정 폼 (한 화면에서 일괄 설정)
- 카테고리별 프로그레스 바 (지출/예산 비율)
- 초과 카테고리 빨간색 하이라이트

**핵심 로직**:
```
소진율(%) = (해당 카테고리 월 지출 합계 / 예산 금액) × 100
잔여 금액 = 예산 금액 - 해당 카테고리 월 지출 합계
초과 여부 = 소진율 > 100
```

---

### 6. 대시보드 (지출 분석)

| # | 기능 | 설명 | 우선순위 |
|---|------|------|----------|
| 6-1 | 이번 달 요약 카드 | 수입, 지출, 남은 용돈 한눈에 표시 | P0 |
| 6-2 | 카테고리별 지출 파이 차트 | 어디에 얼마나 쓰는지 비율 시각화 | P0 |
| 6-3 | 월별 지출 추이 바 차트 | 연간 월별 지출 트렌드 | P1 |
| 6-4 | 예산 대비 지출 프로그레스 | 카테고리별 예산 소진 현황 | P1 |
| 6-5 | 전월 대비 증감 | 전월 대비 지출 변동액/변동률 | P1 |
| 6-6 | 카테고리별 지출 건수 | 각 카테고리에 몇 건 지출했는지 | P2 |
| 6-7 | 연간 총 요약 | 연간 총 수입, 총 지출, 잔액, 월 평균 지출 | P2 |

**화면**: 대시보드 페이지
```
┌─────────────────────────────────────────────┐
│  [이번 달 수입]  [이번 달 지출]  [남은 용돈]  │  ← 요약 카드 3개
├──────────────────────┬──────────────────────┤
│                      │                      │
│   카테고리별 파이차트  │   예산 대비 프로그레스  │
│   (Recharts Pie)     │   (Progress Bars)    │
│                      │                      │
├──────────────────────┴──────────────────────┤
│                                             │
│        월별 지출 추이 바 차트                  │
│        (Recharts Bar/Line)                  │
│                                             │
├─────────────────────────────────────────────┤
│  전월 대비: ▼ 130만원 (-46.4%)               │
└─────────────────────────────────────────────┘
```

**사용 차트 라이브러리**: Recharts
- `PieChart` → 카테고리별 지출 비율
- `BarChart` / `LineChart` → 월별 추이
- 커스텀 `ProgressBar` → 예산 소진율

---

### 7. 공통 기능

| # | 기능 | 설명 | 우선순위 |
|---|------|------|----------|
| 7-1 | JWT 인증 필터 | 모든 API 요청에 토큰 검증 | P0 |
| 7-2 | 본인 데이터 접근 제어 | 타인의 데이터 접근 차단 (user_id 검증) | P0 |
| 7-3 | 입력 유효성 검사 | Bean Validation (@NotBlank, @Min 등) | P0 |
| 7-4 | 전역 예외 처리 | 통일된 에러 응답 형식 (ErrorCode + ErrorResponse) | P0 |
| 7-5 | API 문서 자동 생성 | Swagger UI (SpringDoc) | P1 |
| 7-6 | 금액 포맷팅 | FE에서 천단위 콤마 + "원" 표시 | P0 |
| 7-7 | 반응형 레이아웃 | 모바일/태블릿/데스크탑 대응 | P2 |

---

## 개발 Phase별 기능 매핑

### Phase 2: 사용자 인증
- 1-1 ~ 1-5 (회원가입, 로그인, 토큰 관리)
- 7-1, 7-2 (JWT 필터, 접근 제어)

### Phase 3: 급여 & 지출 핵심
- 2-1 ~ 2-5 (급여 CRUD + 고정 지출 + 가용 용돈)
- 3-1 ~ 3-4 (지출 CRUD + 필터/정렬)
- 4-1, 4-2 (기본 카테고리 + 목록 조회)

### Phase 4: 대시보드 & 분석
- 6-1 ~ 6-5 (요약 카드, 파이 차트, 바 차트, 프로그레스, 전월 비교)
- 통계 API (월별, 카테고리별)

### Phase 5: 예산 & 카테고리 확장
- 5-1 ~ 5-3 (예산 설정/조회/초과 경고)
- 4-3 ~ 4-5 (사용자 정의 카테고리)

### Phase 6: 고도화 (선택)
- 2-6, 2-7, 3-5 ~ 3-7, 5-4, 5-5 (수정/삭제 기능 보강)
- 6-6, 6-7, 7-7 (추가 통계, 반응형)
- 정기 결제 자동 등록
- 지출 리포트 내보내기 (CSV)
- 저축 목표 설정 및 추적

---

## API 엔드포인트 요약 (22개)

| HTTP | 경로 | 기능 | Phase |
|------|------|------|-------|
| POST | `/api/v1/auth/signup` | 회원가입 | 2 |
| POST | `/api/v1/auth/login` | 로그인 | 2 |
| POST | `/api/v1/auth/refresh` | 토큰 갱신 | 2 |
| POST | `/api/v1/salaries` | 급여 등록 | 3 |
| GET | `/api/v1/salaries` | 급여 목록 | 3 |
| GET | `/api/v1/salaries/{id}` | 급여 상세 | 3 |
| PUT | `/api/v1/salaries/{id}` | 급여 수정 | 3 |
| DELETE | `/api/v1/salaries/{id}` | 급여 삭제 | 6 |
| POST | `/api/v1/expenses` | 지출 등록 | 3 |
| GET | `/api/v1/expenses` | 지출 목록 | 3 |
| GET | `/api/v1/expenses/{id}` | 지출 상세 | 3 |
| PUT | `/api/v1/expenses/{id}` | 지출 수정 | 6 |
| DELETE | `/api/v1/expenses/{id}` | 지출 삭제 | 3 |
| GET | `/api/v1/categories` | 카테고리 목록 | 3 |
| POST | `/api/v1/categories` | 카테고리 생성 | 5 |
| PUT | `/api/v1/categories/{id}` | 카테고리 수정 | 5 |
| DELETE | `/api/v1/categories/{id}` | 카테고리 삭제 | 5 |
| PUT | `/api/v1/budgets` | 예산 설정 | 5 |
| GET | `/api/v1/budgets` | 예산 조회 | 5 |
| DELETE | `/api/v1/budgets/{id}` | 예산 삭제 | 5 |
| GET | `/api/v1/statistics/monthly` | 월별 통계 | 4 |
| GET | `/api/v1/statistics/category` | 카테고리별 통계 | 4 |

---

## 데이터 모델 요약

| 엔티티 | 주요 필드 | 관계 |
|--------|-----------|------|
| **User** | email, password, nickname | 1:N → Salary, Expense, Category, Budget |
| **Salary** | year, month, totalAmount, memo | N:1 → User, 1:N → FixedExpense |
| **FixedExpense** | name, amount | N:1 → Salary |
| **Category** | name, color, icon, isDefault | N:1 → User(nullable), 1:N → Expense, Budget |
| **Expense** | amount, description, expenseDate, memo | N:1 → User, N:1 → Category |
| **Budget** | year, month, amount | N:1 → User, N:1 → Category |

상세 ERD 및 DDL: [docs/erd.md](erd.md)
상세 API 명세: [docs/api-spec.md](api-spec.md)

---

## 참고: 레퍼런스 서비스 벤치마킹

| 서비스 | 참고 기능 |
|--------|-----------|
| **뱅크샐러드** | 카테고리별 지출 분석, 파이 차트, 예산 대비 소진율 |
| **토스** | 깔끔한 지출 리스트 UI, 월별 요약 |
| **가계부 앱(편한가계부)** | 고정 지출 등록, 급여 관리, 카테고리 커스텀 |
