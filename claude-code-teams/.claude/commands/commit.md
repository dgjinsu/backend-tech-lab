# Smart Commit - 변경사항 분석 및 자동 커밋

커밋되지 않은 모든 변경사항(staged + unstaged + untracked)을 분석하여 논리적 단위로 그룹핑한 뒤, 각 그룹별로 적절한 커밋 메시지를 작성하고 커밋한다.

$ARGUMENTS

---

## 1단계: 변경사항 수집

아래 명령어를 **병렬로** 실행하여 현재 작업 트리 상태를 파악한다.

```
git status
git diff --stat
git diff --staged --stat
git log --oneline -5
```

---

## 2단계: 변경사항 상세 분석

변경된 파일들의 실제 diff를 확인한다.

- staged 변경: `git diff --staged`
- unstaged 변경: `git diff`
- untracked 파일: 파일 내용 직접 읽기

---

## 3단계: 논리적 그룹핑

변경사항을 아래 기준으로 **논리적 커밋 단위**로 그룹핑한다.

### 그룹핑 기준 (우선순위 순)

1. **기능 단위**: 하나의 기능을 구성하는 파일들 (Controller + Service + Repository + DTO + Entity 등)
2. **도메인 단위**: 같은 도메인 패키지에 속하는 변경 (`domain/user/`, `domain/expense/` 등)
3. **계층 단위**: 같은 레이어의 공통 변경 (전역 설정, 공통 모듈 등)
4. **타입 단위**: 같은 성격의 변경 (테스트만, 문서만, 설정만 등)

### 그룹핑 규칙

- 하나의 커밋에 서로 **무관한 변경을 섞지 않는다**
- 리팩터링과 기능 추가는 **반드시 분리**한다
- 테스트 코드는 해당 프로덕션 코드와 **같은 커밋에 포함**하거나, 테스트만의 독립 커밋으로 분리한다
- 설정 파일 변경(build.gradle, application.yml 등)은 관련 기능 커밋에 포함하거나 별도 커밋으로 분리한다
- 단, 변경사항이 적고 모두 하나의 목적이라면 **하나의 커밋으로 통합**해도 좋다

---

## 4단계: 커밋 메시지 작성

### Conventional Commits 형식

```
<type>: <subject>

<body>
```

### Type (필수)

| Type | 사용 시점 | 예시 |
|------|-----------|------|
| `feat` | 새로운 기능 추가 | `feat: 지출 등록 API 구현` |
| `fix` | 버그 수정 | `fix: 토큰 만료 시 갱신 실패 수정` |
| `refactor` | 동작 변경 없는 코드 개선 | `refactor: UserService 메서드 추출` |
| `test` | 테스트 추가/수정 | `test: 예산 초과 검증 테스트 추가` |
| `docs` | 문서 변경 | `docs: API 명세서 업데이트` |
| `style` | 포맷팅, 세미콜론 등 (동작 변경 없음) | `style: 코드 포맷팅 정리` |
| `chore` | 빌드, 설정, 패키지 등 | `chore: Gradle 의존성 업데이트` |
| `perf` | 성능 개선 | `perf: N+1 쿼리 fetch join 적용` |
| `ci` | CI/CD 설정 변경 | `ci: GitHub Actions 워크플로우 추가` |
| `build` | 빌드 시스템 변경 | `build: Docker 멀티스테이지 빌드 적용` |
| `revert` | 이전 커밋 되돌리기 | `revert: 지출 등록 API 롤백` |

### Subject (필수)

- **한글로 작성** (이 프로젝트의 기존 커밋 스타일 따름)
- 50자 이내
- 마침표(.) 사용하지 않음
- 명령형으로 작성: "추가", "수정", "변경", "제거", "개선"
- **무엇을 했는지(What)** 가 아니라 **왜 했는지(Why)** 에 초점

### Body (선택)

- Subject만으로 의도가 충분히 전달되면 생략
- 변경 이유, 이전 동작과의 차이 등을 설명할 때 작성
- 72자 줄바꿈

### 좋은 예시 vs 나쁜 예시

```
# 좋은 예시
feat: 카테고리별 지출 조회 API 구현
fix: 리프레시 토큰 만료 후 재로그인 불가 수정
refactor: 예산 계산 로직을 별도 서비스로 분리
test: 급여 CRUD 단위 테스트 추가
chore: Docker Compose에 Redis 컨테이너 추가

# 나쁜 예시
feat: 수정                    # 너무 모호
fix: bug fix                  # 무엇을 고쳤는지 불명확
Update files                  # type 누락, 의미 없음
feat: 지출 관련 수정.          # 마침표 사용, 모호한 설명
```

---

## 5단계: 커밋 실행

1. 그룹별로 해당 파일들만 `git add`하여 staging
2. 작성한 커밋 메시지로 커밋 생성
3. 여러 그룹이 있으면 **의존 순서대로** 커밋 (인프라/설정 → 엔티티/도메인 → 서비스 → 컨트롤러 → 프론트엔드 → 테스트 → 문서)
4. 각 커밋 후 `git log --oneline -1`로 결과 확인

---

## 6단계: 결과 보고

모든 커밋 완료 후 아래 형식으로 요약을 보여준다.

```
## 커밋 결과

| # | 커밋 해시 | 메시지 | 포함 파일 수 |
|---|-----------|--------|-------------|
| 1 | abc1234   | feat: ... | 5 |
| 2 | def5678   | test: ... | 3 |

총 N개 커밋 생성 완료
```

---

## 주의사항

- `.env`, `credentials`, 시크릿 파일은 **절대 커밋하지 않는다**. 발견 시 경고한다.
- 커밋 전에 사용자에게 **그룹핑 결과와 커밋 메시지 목록을 먼저 보여주고 확인을 받는다**
- 사용자가 수정을 요청하면 반영 후 다시 확인받는다
- `--amend`는 사용하지 않는다. 항상 새로운 커밋을 생성한다
