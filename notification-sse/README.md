# SSE μ‹¤μ‹κ°„ μ•λ¦Ό μ„λΉ„μ¤

Spring Bootμ™€ Server-Sent Events(SSE)λ¥Ό ν™μ©ν• μ‹¤μ‹κ°„ μ•λ¦Ό μ‹μ¤ν…μ…λ‹λ‹¤.

## π€ μ£Όμ” κΈ°λ¥

- **μ‹¤μ‹κ°„ μ•λ¦Ό**: SSEλ¥Ό ν†µν• μ„λ²„μ—μ„ ν΄λΌμ΄μ–ΈνΈλ΅μ μ‹¤μ‹κ°„ ν‘Έμ‹ μ•λ¦Ό
- **Toast μ•λ**: μ°μΈ΅ μƒλ‹¨μ— λ‚νƒ€λ‚λ” λ¨λν• μ•λ¦Ό UI (μλ™ μ†λ©Έ, μ†λ¦¬ ν¨κ³Ό)
- **μ¤ν”„λΌμΈ μ•λ¦Ό λ³΄κ΄€**: μ—°κ²°λμ§€ μ•μ€ μ‚¬μ©μμ—κ² μ¨ μ•λ¦Όμ„ DBμ— μ €μ¥
- **λ΅κ·ΈμΈ μ‹ λ―Έν™•μΈ μ•λ¦Ό μ „μ†΅**: SSE μ—°κ²° μ‹ μ½μ§€ μ•μ€ μ•λ¦Όμ„ μλ™μΌλ΅ μ „μ†΅
- **νμ› κ°„ λ©”μ‹μ§€ μ „μ†΅**: μ‚¬μ©μλ“¤μ΄ μ„λ΅μ—κ² μ‹¤μ‹κ°„μΌλ΅ λ©”μ‹μ§€ μ „μ†΅
- **λ°μ‘ν• UI**: Thymeleaf κΈ°λ°μ λ¨λν• μ‚¬μ©μ μΈν„°νμ΄μ¤
- **REST API**: Swagger UIλ¥Ό ν†µν• API λ¬Έμ„ν™”

## π“‹ κΈ°μ  μ¤νƒ

- **Backend**
  - Spring Boot 3.5.7
  - Spring Data JPA
  - H2 Database (In-Memory)
  - SSE (Server-Sent Events)
  - Lombok

- **Frontend**
  - Thymeleaf
  - Vanilla JavaScript
  - CSS3 (Gradient Design)

- **API Documentation**
  - Springdoc OpenAPI 3.0 (Swagger)

## π—οΈ ν”„λ΅μ νΈ κµ¬μ΅°

```
src/main/java/com/example/notificationsse/
β”β”€β”€ application/
β”‚   β””β”€β”€ usecase/                    # UseCase (ν¨ν‚¤μ§€λ³„ κµ¬μ„±)
β”‚       β”β”€β”€ getallusers/
β”‚       β”‚   β”β”€β”€ GetAllUsers.java        # μΈν„°νμ΄μ¤
β”‚       β”‚   β”β”€β”€ GetAllUsersService.java # κµ¬ν„μ²΄
β”‚       β”‚   β””β”€β”€ UserRes.java            # DTO
β”‚       β”β”€β”€ sendnotification/
β”‚       β”‚   β”β”€β”€ SendNotification.java        # μΈν„°νμ΄μ¤
β”‚       β”‚   β”β”€β”€ SendNotificationService.java # κµ¬ν„μ²΄
β”‚       β”‚   β”β”€β”€ SendNotificationReq.java     # DTO
β”‚       β”‚   β””β”€β”€ NotificationRes.java         # DTO
β”‚       β”β”€β”€ getunreadnotifications/
β”‚       β”‚   β”β”€β”€ GetUnreadNotifications.java        # μΈν„°νμ΄μ¤
β”‚       β”‚   β”β”€β”€ GetUnreadNotificationsService.java # κµ¬ν„μ²΄
β”‚       β”‚   β””β”€β”€ UnreadNotificationRes.java         # DTO
β”‚       β””β”€β”€ marknotificationasread/
β”‚           β”β”€β”€ MarkNotificationAsRead.java        # μΈν„°νμ΄μ¤
β”‚           β””β”€β”€ MarkNotificationAsReadService.java # κµ¬ν„μ²΄
β”β”€β”€ config/
β”‚   β””β”€β”€ InitDB.java                # μ΄κΈ° λ°μ΄ν„° μ„¤μ •
β”β”€β”€ controller/
β”‚   β”β”€β”€ NotificationController.java # μ•λ¦Ό REST API
β”‚   β”β”€β”€ UserController.java        # νμ› REST API
β”‚   β””β”€β”€ ViewController.java        # ν™”λ©΄ μ»¨νΈλ΅¤λ¬
β”β”€β”€ entity/
β”‚   β”β”€β”€ Notification.java          # μ•λ¦Ό μ—”ν‹°ν‹°
β”‚   β””β”€β”€ User.java                  # νμ› μ—”ν‹°ν‹°
β”β”€β”€ repository/
β”‚   β”β”€β”€ NotificationRepository.java
β”‚   β””β”€β”€ UserRepository.java
β”β”€β”€ service/
β”‚   β””β”€β”€ SseEmitterService.java     # SSE μ—°κ²° κ΄€λ¦¬ μ„λΉ„μ¤
β””β”€β”€ NotificationSseApplication.java

src/main/resources/
β”β”€β”€ application.yml                # μ• ν”λ¦¬μΌ€μ΄μ… μ„¤μ •
β””β”€β”€ templates/
    β””β”€β”€ index.html                 # λ©”μΈ ν™”λ©΄
```

## π”§ μ‹¤ν–‰ λ°©λ²•

### 1. μμ΅΄μ„± λ‹¤μ΄λ΅λ“ λ° λΉλ“

```bash
./gradlew clean build
```

### 2. μ• ν”λ¦¬μΌ€μ΄μ… μ‹¤ν–‰

```bash
./gradlew bootRun
```

λλ” IDEμ—μ„ `NotificationSseApplication.java`λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤.

### 3. μ ‘μ†

- **μ›Ή ν™”λ©΄**: http://localhost:8888
- **Swagger UI**: http://localhost:8888/swagger-ui.html
- **H2 Console**: http://localhost:8888/h2-console
  - JDBC URL: `jdbc:h2:mem:testdb`
  - Username: `sa`
  - Password: (λΉ„μ–΄μμ)

## π“± μ‚¬μ© λ°©λ²•

### μ›Ή ν™”λ©΄μ—μ„ ν…μ¤νΈ

1. λΈλΌμ°μ €λ¥Ό 2κ° μ΄μƒ μ—΄μ–΄ http://localhost:8888 μ ‘μ†
2. κ° λΈλΌμ°μ €μ—μ„ λ‹¤λ¥Έ μ‚¬μ©μ μ„ νƒ (user1, user2, user3, user4)
3. "μ—°κ²°ν•κΈ°" λ²„νΌ ν΄λ¦­ν•μ—¬ SSE μ—°κ²°
4. λ°›λ” μ‚¬λμ„ μ„ νƒν•κ³  λ©”μ‹μ§€ μ…λ ¥ ν›„ μ „μ†΅
5. μμ‹ μ λΈλΌμ°μ €μ—μ„ μ‹¤μ‹κ°„μΌλ΅ **Toast μ•λ** μμ‹  ν™•μΈ (μ°μΈ΅ μƒλ‹¨μ— ν‘μ‹)

### μ¤ν”„λΌμΈ μ•λ¦Ό ν…μ¤νΈ

1. **λΈλΌμ°μ € A**: user1λ΅ μ—°κ²°
2. **λΈλΌμ°μ € B**: user2λ” μ—°κ²°ν•μ§€ μ•κ³  λ€κΈ°
3. **λΈλΌμ°μ € A**: user1μ΄ user2μ—κ² λ©”μ‹μ§€ μ „μ†΅
4. **μ„λ²„ λ΅κ·Έ**: "μμ‹ μ λ―Έμ—°κ²°. λ‚μ¤‘μ— μ „μ†΅λ  μμ •" λ©”μ‹μ§€ ν™•μΈ
5. **λΈλΌμ°μ € B**: user2λ΅ μ—°κ²°ν•κΈ° ν΄λ¦­
6. **κ²°κ³Ό**: μ—°κ²° μ¦‰μ‹ λ―Έν™•μΈ μ•λ¦Όμ΄ Toastλ΅ ν‘μ‹λ¨! π‰

### APIλ¥Ό ν†µν• ν…μ¤νΈ

#### 1. μ „μ²΄ νμ› μ΅°ν
```bash
curl -X GET http://localhost:8888/api/v1/users
```

#### 2. SSE μ—°κ²° (EventSource μ‚¬μ©)
```javascript
const eventSource = new EventSource('http://localhost:8888/api/v1/notifications/subscribe/user1');

eventSource.addEventListener('connect', (event) => {
  console.log('μ—°κ²°λ¨:', event.data);
});

eventSource.addEventListener('notification', (event) => {
  const notification = JSON.parse(event.data);
  console.log('μ•λ¦Ό λ°›μ:', notification);
});
```

#### 3. μ•λ¦Ό μ „μ†΅
```bash
curl -X POST http://localhost:8888/api/v1/notifications \
  -H "Content-Type: application/json" \
  -d '{
    "senderUserId": "user1",
    "receiverUserId": "user2",
    "message": "μ•λ…•ν•μ„Έμ”!"
  }'
```

## π“ λ°μ΄ν„°λ² μ΄μ¤ κµ¬μ΅°

### users ν…μ΄λΈ”
| μ»¬λΌλ… | νƒ€μ… | μ„¤λ… |
|-------|------|------|
| id | BIGINT | PK (μλ™ μ¦κ°€) |
| user_id | VARCHAR(50) | μ‚¬μ©μ ID (unique) |
| name | VARCHAR(100) | μ‚¬μ©μ μ΄λ¦„ |

### notifications ν…μ΄λΈ”
| μ»¬λΌλ… | νƒ€μ… | μ„¤λ… |
|-------|------|------|
| id | BIGINT | PK (μλ™ μ¦κ°€) |
| sender_id | BIGINT | λ°μ‹ μ ID (FK) |
| receiver_id | BIGINT | μμ‹ μ ID (FK) |
| message | VARCHAR(500) | λ©”μ‹μ§€ λ‚΄μ© |
| created_at | TIMESTAMP | μƒμ„± μ‹κ°„ |
| is_read | BOOLEAN | μ½μ μ—¬λ¶€ |

## π― μ£Όμ” νΉμ§•

### SSE (Server-Sent Events)

- HTTP κΈ°λ°μ λ‹¨λ°©ν–¥ μ‹¤μ‹κ°„ ν†µμ‹ 
- μ„λ²„μ—μ„ ν΄λΌμ΄μ–ΈνΈλ΅ μ΄λ²¤νΈ ν‘Έμ‹
- μλ™ μ¬μ—°κ²° μ§€μ›
- WebSocketλ³΄λ‹¤ κ°€λ³κ³  κµ¬ν„μ΄ κ°„λ‹¨

### μ¤ν”„λΌμΈ μ•λ¦Ό μ²λ¦¬ λ΅μ§

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 1. λ©”μ‹μ§€ μ „μ†΅ μ”μ²­                               β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                  β”‚
                  β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 2. DBμ— μ•λ¦Ό μ €μ¥ (isRead = false)               β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                  β”‚
                  β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 3. SSE μ—°κ²° ν™•μΈ                                 β”‚
β””β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
      β”‚                           β”‚
   μ—°κ²°λ¨                      λ―Έμ—°κ²°
      β”‚                           β”‚
      β–Ό                           β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”          β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ μ¦‰μ‹ μ „μ†΅    β”‚          β”‚ DBμ—λ§ μ €μ¥       β”‚
β”‚ isRead=true β”‚          β”‚ isRead=false     β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”          β””β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                  β”‚
                         λ‚μ¤‘μ— μ—°κ²° μ‹
                                  β”‚
                                  β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚ λ―Έν™•μΈ μ•λ¦Ό μ΅°ν λ° μ „μ†΅   β”‚
                    β”‚ μ „μ†΅ ν›„ isRead=true       β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### Clean Architecture

- UseCase κΈ°λ°μ λΉ„μ¦λ‹μ¤ λ΅μ§ λ¶„λ¦¬
- μΈν„°νμ΄μ¤λ¥Ό ν†µν• μμ΅΄μ„± μ—­μ „
- DTOλ¥Ό ν†µν• κ³„μΈµ κ°„ λ°μ΄ν„° μ „λ‹¬
- ResponseEntityλ¥Ό ν†µν• ν‘μ¤€ HTTP μ‘λ‹µ μ²λ¦¬

## π” μ΄κΈ° λ°μ΄ν„°

μ• ν”λ¦¬μΌ€μ΄μ… μ‹μ‘ μ‹ μλ™μΌλ΅ 4λ…μ ν…μ¤νΈ μ‚¬μ©μκ°€ μƒμ„±λ©λ‹λ‹¤:

- user1 (ν™κΈΈλ™)
- user2 (κΉ€μ² μ)
- user3 (μ΄μν¬)
- user4 (λ°•λ―Όμ)

## π¨ Toast μ•λ κΈ°λ¥

- μ°μΈ΅ μƒλ‹¨μ— μ¬λΌμ΄λ“μΈ μ• λ‹λ©”μ΄μ…
- λ°μ‹ μ μ •λ³΄ ν‘μ‹
- λ©”μ‹μ§€ λ‚΄μ© ν‘μ‹
- μ‹κ°„ ν‘μ‹
- 5μ΄ ν›„ μλ™ μ†λ©Έ
- Γ— λ²„νΌμΌλ΅ μ¦‰μ‹ λ‹«κΈ°
- μ•λ μ†λ¦¬ ν¨κ³Ό (Web Audio API)

## π“ λΌμ΄μ„Όμ¤

MIT License

